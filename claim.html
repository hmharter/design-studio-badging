<html>
<head>
  <title>Heather's Design Studio Website</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <!-- Stylesheet -->
  <link rel="stylesheet" type="text/css" href="css/style.css">
  <!-- JavaScript codes -->
  <script src="../js/jquery-1.9.0.min.js" type="text/javascript"></script>
  <script src="https://backpack.openbadges.org/issuer.js"></script>
  <link href='http://fonts.googleapis.com/css?family=Roboto:100,300,500' rel='stylesheet' type='text/css'>

</head>

<body>
<div id="container">

  <h1>Claim a badge</h1>

  <form id="claimbadge" action="" method="post">
    <label>Enter Email Address to claim badge: </label><input type="email" name="emailaddress" />
    <input type="button" value="Find my badges" class="find" />
    <div id="badges" name="badges"></div>
    <input type="button" value="Claim Badge!" class="claim" />
  </form>

</div>

<script>


  $("input.find").on("click",function() {
    console.log("find click");
    $('#badges input').detach();
    var badgestr = "";
    $.getJSON("findbadges.php", function(data) {
      $.each(data, function(b, badge) {
        badgestr = "<div class='badge'><input type='radio' name='earnedbadges' id='" + badge.assertionid + "' value='" + badge.assertionid + "'><label for='" + badge.assertionid + "'><a target='_blank' href='" + badge.criteria + "'>" + badge.name + "</a></label></div>";
        console.log(badgestr);
        $('#badges').append(badgestr);
      })
    })
  })


  $("input.claim").on("click",function() {
    console.log("claim click");
    var assertionid = $("#badges input[name=earnedbadges]:checked").val();
    var assertionurl = "http://insys.vmhost.psu.edu/~hms181/badging/data/assertions/" + assertionid + ".json";
    console.log("assertion url: " + assertionurl);
    OpenBadges.issue([assertionurl],function(errors, successes) {
      if (errors.length>0) {
        console.log("Badge Error:");
        console.log('%j',errors)
      }
      if (successes.length>0) {
        console.dir("Badge Succes:" + successes);
      }
    });
  })


</script>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-38178749-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</body>
</html>