<html>
<head>
  <title>Badger - Create and Issue Digital Badges</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">

  <!-- Stylesheet -->
  <link rel="stylesheet" type="text/css" href="css/style.css">

  <!-- JavaScript codes -->
  <script src="../js/jquery-1.9.0.min.js" type="text/javascript"></script>
  <script src="https://backpack.openbadges.org/issuer.js"></script>
  <link href='http://fonts.googleapis.com/css?family=Roboto:100,300,500' rel='stylesheet' type='text/css'>

  <script>
    function refreshissuers() {
      $('#issuers option').detach();
      $.getJSON("listissuers.php", function(data){
        $.each(data, function(i, issuer) {
            var issuerstr = "<option value='" + issuer.id + "'>" + issuer.name + ", " + issuer.url + "</option>";
            console.log(issuerstr);
            $('#issuers').append(issuerstr);
        });
      });
    }

    function refreshbadges() {
      $('#badges option').detach();
      $.getJSON("listbadges.php", function(data) {
        $.each(data, function(b, badge) {
          var badgestr = "<option value='" + badge.id + "'>" + badge.name + ", " + badge.criteria + "</option>";
          console.log(badgestr);
          $('#badges').append(badgestr);
        })
      })
    }

    jQuery(document).ready(function() {
      refreshissuers();
      refreshbadges();
    })
  </script>

</head>

<body>

  <section class="hero">
    <div class="wrapper">
      <div class="text"><i class="icon-badger-black"></i> Badger</div>
    </div>
  </section>

  <header>
    <div class="header">
      <i class="icon-badger-black"></i> <h1 class="hide">Badger</h1>
      <nav>
        <ul>
          <li><a href="#">Get Started</a></li>
          <li><a href="#">Register</a></li>
          <li><a href="#">Create</a></li>
          <li><a href="#">Issue</a></li>
          <li><a href="#">Claim</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <section class="mainsection">

    <div class="wrapper">

      <h2>Get Started</h2>
      <p>This is information about how to get started with badging</p>

      <h2>Step One: Register</h2>
      <p>To issue a badge, you need to register yourself as an official "issuer" in the system. If you've registered before, skip to Step 2.</p>

      <form id="regissuer" action="" method="post">
        <label>Issuer Name: </label><input type="text" id="issuername" name="issuername" />
        <label>Issuer URL: </label><input type="url" id="issuerurl" name="issuerurl" />
        <label>Issuer Description: </label><textarea rows="2" id="issuerdesc" name="issuerdesc"></textarea>
        <label>Issuer Email: </label><input type="email" id="issueremail" name="issueremail" />
        <label>Issuer Logo: </label><input type="file" id="issuerlogo" name="issuerlogo" />
        <input type="button" value="Register!" class="regissuer" />
      </form>


      <h2>Create a Badge</h2>
      <p>Now that you're registered as an issuer, you'll need to create your badge. If you've already created your badge, skip to Step 3.</p>

      <form id="createbadge" action="" method="post" enctype="multipart/form-data">
        <label>Badge Name: </label><input type="text" id="badgename" name="badgename" />
        <label>Badge Description: </label><textarea rows="3" id="badgedesc" name="badgedesc"></textarea>
        <label>Badge Image: </label><input type="file" id="badgeimg" name="badgeimg" />
        <label>Badge Criteria URL: </label><input type="url" id="badgecriteria" name="badgecriteria" />
        <label>Badge Issuer: </label><select id="issuers" name="issuers"></select>
        <input type="button" value="Create Badge!" class="create" />
      </form>


      <h2>Issue a Badge</h2>

      <form id="issuebadge" action="" method="post">
        <label>Choose a Badge: </label><select id="badges" name="badges"></select>
        <label>Issue Badge To (email address): </label><input type="email" name="emailaddress" />
        <label>Evidence URL: </label><input type="url" name="evidence" id="evidence" />
        <input type="button" value="Issue Badge!" class="issue" />
      </form>

      <h2>Claim a Badge</h2>

      <a href="claim.html">claim a badge</a>

    </div>
  </section>

  <script>

  jQuery(function(){
    var menuOffset = jQuery('header')[0].offsetTop;
    jQuery(document).bind('ready scroll',function() {
      var docScroll = jQuery(document).scrollTop();
      if(docScroll >= menuOffset) {
        jQuery('header').addClass('fixed');
        jQuery('.mainsection').addClass('fixedheader');
      } else {
        jQuery('header').removeClass('fixed');
        jQuery('.mainsection').removeClass('fixedheader');
      }
     });
  });

    $("input.regissuer").on("click",function() {
      console.log("regissuer click");
      $.post('regissuer.php', $("form#regissuer").serialize())
        .done( function(url) {
          console.log("Issuer URL: " + url);
      });
      refreshissuers();
    });

    $("input.create").on("click",function() {
      console.log("create click");
      $.post('badgecreate.php', $("form#createbadge").serialize())
        .done( function(url) {
          console.log("Badge URL: " + url);
      });
      refreshbadges();
    });

    $("input.issue").on("click",function() {
      console.log("issue click");
      $.post('writeassertionjson.php', $("form#issuebadge").serialize())
        .done( function(url) {
          console.log("Assertion URL: " + url);
          if (url.indexOf("http") < 0) {
            alert("You have already issued this badge. Please choose another badge or specify a different recipient.");
          }
      });
    });
  </script>

  <script type="text/javascript">

    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-38178749-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();

  </script>
</body>
</html>